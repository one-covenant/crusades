# Templar Crusades

**Compete to write the fastest PyTorch training code.**

```
                              TOURNAMENT FLOW
    ============================================================================
    
    MINER                           BLOCKCHAIN                      VALIDATOR
    -----                           ----------                      ---------
    
    train.py                                                              
       |                                                                  
       v                                                                  
    [Docker Image] -----> [Commit Hash] -----> [Reveal after 100 blocks]  
                               |                         |                
                               |                         v                
                               |              [Pull Image & Evaluate]     
                               |                         |                
                               |                         v                
                               |              [Run 2x, Take Median TPS]   
                               |                         |                
                               v                         v                
                          [Leaderboard] <----- [Score: 3,596 TPS]         
                               |                                          
                               v                                          
                      [set_weights on chain]                              
                         /           \                                    
                        /             \                                   
                    95%                5%                                  
                      |                 |                                  
                      v                 v                                  
                 Validator           Winner                               
    
    ============================================================================
```

## Miners

### Setup
```bash
git clone https://github.com/one-covenant/crusades.git && cd crusades
uv sync
uv run python scripts/setup_benchmark.py  # Download model & data
```

### Local Testing
```bash
uv run python train.py
```

### Submit
```bash
# Build
uv run python -m neurons.miner build train.py --image my-submission --tag v1

# Commit to blockchain
uv run python -m neurons.miner commit \
    --image my-submission:v1 \
    --wallet.name mywallet \
    --wallet.hotkey myhotkey \
    --network finney

# Check status
uv run python -m neurons.miner status --wallet.name mywallet --wallet.hotkey myhotkey
```

### Code Requirements

```python
def inner_steps(model, data_iterator, optimizer, num_steps, device) -> InnerStepsResult:
    """Run training steps. Return (final_logits, total_tokens, final_loss)."""
```

**Rules:**
- Output must match reference within 3%
- Must complete in 10 minutes
- No network/subprocess calls

---

## Validators

```bash
git clone https://github.com/one-covenant/crusades.git && cd crusades
uv sync

uv run python -m neurons.validator \
    --wallet.name validator \
    --wallet.hotkey default \
    --affinetes-mode docker
```

---

## Dashboard (TUI)

```bash
uv run python -m tournament.tui --db tournament.db
```

Controls: `j/k` navigate, `h/l` switch panels, `Enter` view details, `c` toggle code, `q` quit

---

## Configuration

Edit `hparams/hparams.json`:

| Setting | Value | Description |
|---------|-------|-------------|
| `benchmark_model_name` | `Qwen/Qwen2.5-7B` | Model |
| `benchmark_dataset_name` | `HuggingFaceFW/fineweb` | Dataset |
| `benchmark_batch_size` | `16` | Batch size |
| `benchmark_sequence_length` | `1024` | Sequence length |
| `evaluation_runs` | `2` | Runs per submission |
| `reveal_blocks` | `100` | Blocks until reveal (~20 min) |
| `burn_rate` | `0.95` | Validator share (5% to winner) |
| `output_vector_tolerance` | `0.03` | Max diff (3%) |

---

## Data Seeds

| Mode | Seed | Purpose |
|------|------|---------|
| Miner (local) | Fixed (42) | Reproducible testing |
| Validator | Random (block hash) | Unpredictable evaluation |

---

## Files

```
crusades/
├── train.py                    # YOUR CODE - optimize this
├── neurons/
│   ├── miner.py                # build, commit, status
│   └── validator.py            # evaluation loop
├── environments/templar/
│   ├── env.py                  # evaluation harness
│   └── train.py                # baseline
├── hparams/hparams.json        # configuration
└── benchmark/                  # generated by setup_benchmark.py
    ├── model/
    └── data/train.pt
```
